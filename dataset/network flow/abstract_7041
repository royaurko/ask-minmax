Anisotropic flow coefficients v_1-v_5 in heavy ion collisions are computed by
combining a classical Yang-Mills description of the early time glasma flow with
the subsequent relativistic viscous hydrodynamic evolution of matter through
the quark-gluon plasma and hadron gas phases. The glasma dynamics, as realized
in the IP-Glasma model, takes into account event-by-event geometric
fluctuations in nucleon positions and intrinsic sub-nucleon scale color charge
fluctuations; the pre-equilibrium flow of matter is then matched to the MUSIC
algorithm describing viscous hydrodynamic flow and particle production at
freeze-out. The IP-Glasma+MUSIC model describes well both transverse momentum
dependent and integrated v_n data measured at the Large Hadron Collider (LHC)
and the Relativistic Heavy Ion Collider (RHIC). The model also reproduces the
event-by-event distributions of v_2, v_3 and v_4 measured by the ATLAS
collaboration. The implications of our results for better understanding of the
dynamics of the glasma as well as for the extraction of transport properties of
the quark-gluon plasma are outlined.