Neural cryptography is based on synchronization of tree parity machines by
mutual learning. We extend previous key-exchange protocols by replacing random
inputs with queries depending on the current state of the neural networks. The
probability of a successful attack is calculated for different model parameters
using numerical simulations. The results show that queries restore the security
against cooperating attackers. The success probability can be reduced without
increasing the average synchronization time.