We present a definition of spectral flow relative to any norm closed ideal J
in any von Neumann algebra N. Given a path D(t) of selfadjoint operators in N
which are invertible in N/J, the spectral flow produces a class in K_0(J). In
the case when N is semifinite, the numerical spectral flow of the path
coincides with the value of trace on the associated K-class. Given a semifinite
spectral triple (A,H,D) relative to a semifinite von Neumann algebra N, we
construct a class [D] in KK^1(A,N') such that, for a unitary u in A, the von
Neumann spectral flow between D and u*Du is equal to the Kasparov product of
[u] and [D].