We study the instability of a superfluid flow through a constriction in three
spatial dimensions. We consider a Bose-Einstein condensate at zero temperature
in two different geometries: a straight waveguide and a torus. The constriction
consists of a broad, repulsive penetrable barrier. In the hydrodynamic regime,
we find that the flow becomes unstable as soon as the velocity at the classical
(Thomas-Fermi) surface equals the sound speed inside the constriction. At this
critical point, vortex rings enter inside the bulk region of the cloud. The
nucleation and dynamics scenario is strongly affected by the presence of
asymmetries in the velocity and density of the background condensate flow.