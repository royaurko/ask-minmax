We introduce a cellular automaton model coupled with a transport equation for
flows on graphs. The direction of the flow is described by a switching process
where the switching probability dynamically changes according to the value of
the transported quantity in the neighboring cells. A motivation is pedestrian
dynamics in a small corridor where the propagation of people in a part of the
corridor can be either left or rightgoing. Under the assumptions of propagation
of chaos and mean-field limit, we derive a master equation and the
corresponding meanfield kinetic and macroscopic models. Steady--states are
computed and analyzed analytically and exhibit the possibility of multiple
meta-stable states and hysteresis.