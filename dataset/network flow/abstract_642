This paper studies the problem of output agreement in networks of nonlinear
dynamical systems under time-varying disturbances, using dynamic diffusive
couplings. Necessary conditions are derived for general networks of nonlinear
systems, and these conditions are explicitly interpreted as conditions relating
the node dynamics and the network topology. For the class of incrementally
passive systems, necessary and sufficient conditions for output agreement are
derived. The approach proposed in the paper lends itself to solve flow control
problems in distribution networks. As a first case study, the internal model
approach is used for designing a controller that achieves an optimal routing
and inventory balancing in a dynamic transportation network with storage and
time-varying supply and demand. It is in particular shown that the time-varying
optimal routing problem can be solved by applying an internal model controller
to the dual variables of a certain convex network optimization problem. As a
second case study, we show that droop-controllers in microgrids have also an
interpretation as internal model controllers.