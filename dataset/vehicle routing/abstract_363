Password: We generalize the standard vehicle routing problem by allowing soft time window and soft traveling time constraints, where both constraints are treated as cost functions. With the proposed generalization, the problem becomes very general. In our algorithm, we use local search to determine the routes of vehicles. After fixing the route of each vehicle, we must determine the optimal start times of services at visited customers. We show that this subproblem is NP-hard when cost functions are general, but can be efficiently solved with dynamic programming when traveling time cost functions are convex even if time window cost functions are non-convex. We deal with the latter situation in the developed iterated local search algorithm. Finally we report computational results on benchmark instances, and confirm the benefits of the proposed generalization. Keywords Dynamic programming ; General time windows ; Flexible traveling time ; Local search ; Vehicle routing problem 1. Introduction The vehicle routing problem (VRP) is the problem of minimizing the total travel distance of a number of vehicles, under various constraints, where every customer must be visited exactly once by a vehicle [10] , [11]  and  [24] . This is one of the representative combinatorial optimization problems and is known to be NP-hard. Among variants of VRP, the VRP with capacity and time window constraints, called the vehicle routing problem with time windows (VRPTW), has been widely studied in the last decade [15] , [19] , [22]  and  [25] . The capacity constraint signifies that the total load on a route cannot exceed the capacity of the assigned vehicle. The time window constraint signifies that each vehicle must start the service at each customer in the period specified by the customer. The VRPTW has a wide range of applications such as bank deliveries, postal deliveries, school bus routing and so on, and it has been a subject of intensive research focused mainly on heuristic and metaheuristic approaches [6]  and  [7] . Among recent approaches are a multi-start local search [8] , a two-stage hybrid local search [2] , a hybrid genetic algorithm [3] , a reactive variable neighborhood search [5] , a two-phase hybrid metaheuristic algorithm [13] , a variable neighborhood decent with constraint-based operators [21] and so on. See extensive surveys by Bräysy and Gendreau [6]  and  [7] for heuristic and metaheuristic approaches. A constraint is called hard if it must be satisfied, while it is called soft if it can be violated. The violation of soft constraints is usually penalized and added to the objective function. The VRP with hard (resp., soft) time window constraints is abbreviated as VRPHTW (resp., VRPSTW). For VRPHTW, even just finding a feasible schedule with a given number of vehicles is known to be NP-complete, because it includes the one-dimensional bin packing problem as a special case [12] . It may not be reasonable to restrict the search only within the feasible region of VRPHTW, especially when the constraints are tight. Moreover, in real-world situation, time window and capacity constraints can be often violated to some extent. Considering these, the two constraints are treated as soft in this paper. In our previous paper [14] , we have already considered soft time window constraints, where their cost functions can be non-convex and/or discontinuous as long as it is piecewise linear. This formulation is quite general; e.g., one or more time slots can be assigned to each customer. In this paper, in addition to soft time window constraints, we treat the traveling times between customers as variables. The difference between the start times of services at a customer i and the next customer j in a route is the sum of the following three components: (1) the service time of i , (2) the traveling time between i and j , and (3) the waiting time at j . The service time and the traveling time are given as constant values, in standard VRP formulation. In practice, however, these values can be changed with some cost (e.g., the service time can be shortened by investing more work force, and the traveling time can be shortened by paying the turnpike toll). We therefore redefine the traveling time as a variable representing the difference between the start times of services at two consecutive customers, and introduce its cost function. Our goal is to find a flexible solution, whose cost is considerably small, with a little penalty if necessary. With soft time windows and/or variable traveling times, even after fixing the order of customers for each vehicle to visit, it becomes non-trivial to determine the optimal start times of services at all customers so that the total cost of the vehicle is minimized. We first show that this problem is NP-hard when cost functions are general. We then consider a restricted problem, which is still NP-hard, and propose a dynamic programming algorithm whose time complexity is of pseudo-polynomial order. Then, assuming that traveling time cost functions are convex we modify the dynamic programming into a polynomial time algorithm, which is then incorporated in the iterated local search algorithm of this paper. We conduct computational experiments on representative benchmark instances of VRPTW. Our algorithm can find solutions whose traveling distances are much smaller than those of the best-known solutions by allowing small violations of the given time window and/or traveling time constraints. The outcomes may indicate the usefulness of the proposed generalization.