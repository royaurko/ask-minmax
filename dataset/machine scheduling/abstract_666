This paper considers a heterogeneous ad hoc network with multiple
transmitter-receiver pairs, in which all transmitters are capable of harvesting
renewable energy from the environment and compete for one shared channel by
random access. In particular, we focus on two different scenarios: the constant
energy harvesting (EH) rate model where the EH rate remains constant within the
time of interest and the i.i.d. EH rate model where the EH rates are
independent and identically distributed across different contention slots. To
quantify the roles of both the energy state information (ESI) and the channel
state information (CSI), a distributed opportunistic scheduling (DOS) framework
with two-stage probing and save-then-transmit energy utilization is proposed.
Then, the optimal throughput and the optimal scheduling strategy are obtained
via one-dimension search, i.e., an iterative algorithm consisting of the
following two steps in each iteration: First, assuming that the stored energy
level at each transmitter is stationary with a given distribution, the expected
throughput maximization problem is formulated as an optimal stopping problem,
whose solution is proved to exist and then derived for both models; second, for
a fixed stopping rule, the energy level at each transmitter is shown to be
stationary and an efficient iterative algorithm is proposed to compute its
steady-state distribution. Finally, we validate our analysis by numerical
results and quantify the throughput gain compared with the best-effort delivery
scheme.