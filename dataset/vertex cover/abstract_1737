It has been argued that the Nekrasov's partition function gives the
generating function of refined BPS state counting in the compactification of M
theory on local Calabi-Yau spaces. We show that a refined version of the
topological vertex we proposed before (hep-th/0502061) is a building block of
the Nekrasov's partition function with two equivariant parameters. Compared
with another refined topological vertex by Iqbal-Kozcaz-Vafa (hep-th/0701156),
our refined vertex is expressed entirely in terms of the specialization of the
Macdonald symmetric functions which is related to the equivariant character of
the Hilbert scheme of points on C^2. We provide diagrammatic rules for
computing the partition function from the web diagrams appearing in geometric
engineering of Yang-Mills theory with eight supercharges. Our refined vertex
has a simple transformation law under the flop operation of the diagram, which
suggests that homological invariants of the Hopf link are related to the
Macdonald functions.