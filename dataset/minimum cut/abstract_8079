We explore the minimal conditions which enable the formation of
metal-enriched solar and sub-solar mass stars. We find that in the absence of
dust grains, gas fragmentation occurs at densities nH ~ [10^4-10^5]cm^{-3} when
the metallicity exceeds Z ~ 10^{-4} Zsun. The resulting fragmentation masses
are > 10 Msun. The inclusion of Fe and Si cooling does not affect the thermal
evolution as this is dominated by molecular cooling even for metallicities as
large as Z = 10^{-2} Zsun. The presence of dust is the key driver for the
formation of low-mass stars. We focus on three representative core-collapse
supernova (SN) progenitors, and consider the effects of reverse shocks of
increasing strength: these reduce the depletion factors, fdep =
Mdust/(Mdust+Mmet), alter the shape of the grain size distribution function and
modify the relative abundances of grain species and of metal species in the gas
phase. We find that the lowest metallicity at which fragmentation occurs is
Z=10^{-6} Zsun for gas pre-enriched by the explosion of a 20 Msun primordial SN
(fdep > 0.22) and/or by a 35 Msun, Z=10^{-4} Zsun SN (fdep > 0.26); it is ~ 1
dex larger, when the gas is pre-enriched by a Z = 10^{-4} Zsun, 20 Msun SN
(fdep > 0.04). Cloud fragmentation depends on the depletion factor and it is
suppressed when the reverse shock leads to a too large destruction of dust
grains. These features are all consistent with the existence of a minimum
dust-to-gas ratio, Dcr, above which fragmentation is activated. We derive a
simple analytic expression for Dcr which, for grain composition and properties
explored in the present study, reads Dcr = [2.6 - 6.3] x 10^{-9}. When the
dust-to-gas ratio of star forming clouds exceeds this value, the fragmentation
masses range between 0.01 Msun and 1 Msun, thus enabling the formation of the
first low-mass stars.