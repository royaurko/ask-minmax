This work takes up the challenges of utility maximization problem when the
market is indivisible and the transaction costs are included. First there is a
so-called solvency region given by the minimum margin requirement in the
problem formulation. Then the associated utility maximization is formulated as
an optimal switching problem. The diffusion turns out to be degenerate and the
boundary of domain is an unbounded set. One no longer has the continuity of the
value function without posing further conditions due to the degeneracy and the
dependence of the random terminal time on the initial data. This paper provides
sufficient conditions under which the continuity of the value function is
obtained. The essence of our approach is to find a sequence of continuous
functions locally uniformly converging to the desired value function. Thanks to
continuity, the value function can be characterized by using the notion of
viscosity solution of certain quasi-variational inequality.