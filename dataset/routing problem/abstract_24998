Consider a subset $A$ of $\mathbb{F}_p^n$ and a decomposition of its
indicator function as the sum of two bounded functions $1_A=f_1+f_2$. For every
family of linear forms, we find the smallest degree of uniformity $k$ such that
assuming that $\|f_2\|_{U^k}$ is sufficiently small, it is possible to discard
$f_2$ and replace $1_A$ with $f_1$ in the average over this family of linear
forms, affecting it only negligibly. Previously, Gowers and Wolf solved this
problem for the case where $f_1$ is a constant function. Furthermore, our main
result solves Problem 7.6 in [W. T. Gowers and J. Wolf. Linear forms and
higher-degree uniformity for functions on $\mathbb{F}_p^n$. Geom. Funct. Anal.,
21(1):36--69, 2011] regarding the analytic averages that involve more than one
subset of $\mathbb{F}_p^n$.] regarding the analytic averages that involve more
than one subset of $\mathbb{F}_p^n$.