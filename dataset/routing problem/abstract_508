We study the formation of molecular hydrogen, after the epoch of
re-ionization, in the context of canonical galaxy formation theory due to
hierarchical clustering. There is an initial epoch of $H_2$ production in the
gas phase through the $H^-$ route which ends at a redshift of order unity. Star
formation in the protogalactic disks can become self-regulated. The process
responsible for the feedback is heating of the gas by the internal stellar
radiation field which can dominate the background radiation field at various
epochs. It is possible to define a maximum star formation rate during this
epoch. Plausible estimates give a rate of 0.2-2 Mo yr-1 for condensations
corresponding to 1 sigma and 2 sigma initial density fluctuations. Therefore,
the production of metals and dust proceeds slowly in this phase. This moderate
epoch is terminated by a phase transition to a cold dense and warm
neutral/ionized medium once the metals and dust have increased to a level
Z=0.03-0.1 Z_o. Then: (1) atoms and molecules such as C, O and CO become
abundant and cool the gas to below $300 K$ ; (2) the dust abundance has become
sufficiently high to allow shielding of the molecular gas and; (3) molecular
hydrogen formation can occur rapidly on grain surfaces. This phase transition
occurs at a redshift of approximately 1.5, with a fiducial range of 1.2<z<2.
The combination of feedback and a phase transition provides a natural
resolution of the G-dwarf problem.