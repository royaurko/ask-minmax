Let d1 and d2 be discriminants of distinct quadratic imaginary orders O_d1
and O_d2 and let J(d1,d2) denote the product of differences of CM j-invariants
with discriminants d1 and d2. In 1985, Gross and Zagier gave an elegant formula
for the factorization of the integer J(d1,d2) in the case that d1 and d2 are
relatively prime and discriminants of maximal orders. To compute this formula,
they first reduce the problem to counting the number of simultaneous embeddings
of O_d1 and O_d2 into endomorphism rings of supersingular curves, and then
solve this counting problem.
  Interestingly, this counting problem also appears when computing class
polynomials for invariants of genus 2 curves. However, in this application, one
must consider orders O_d1 and O_d2 that are non-maximal. Motivated by the
application to genus 2 curves, we generalize the methods of Gross and Zagier
and give a computable formula for v_p(J(d1,d2)) for any distinct pair of
discriminants d1,d2 and any prime p>2. In the case that d1 is squarefree and d2
is the discriminant of any quadratic imaginary order, our formula can be stated
in a simple closed form. We also give a conjectural closed formula when the
conductors of d1 and d2 are relatively prime.