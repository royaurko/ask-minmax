We study Schrodinger operators with a one-frequency analytic potential,
focusing on the transition between the two distinct local regimes
characteristic respectively of large and small potentials. From the dynamical
point of view, the transition signals the emergence of nonuniform
hyperbolicity, so the dependence of the Lyapunov exponent with respect to
parameters plays a central role in the analysis. Though often ill-behaved by
conventional measures, we show that the Lyapunov exponent is in fact remarkably
regular in a ``stratified sense'' which we define: the irregularity comes from
the matching of nice (analytic or smooth) functions along sets with complicated
geometry. This result allows us to stablish that the ``critical set'' for the
transition has at most codimension one, so for a typical potential the set of
critical energies is at most countable, hence typically not seen by spectral
measures. Key to our approach are two results about the dependence of the
Lyapunov exponent of one-frequency $\SL(2,\C)$ cocycles with respect to
perturbations in the imaginary direction: on one hand there is a severe
``quantization'' restriction, and on the other hand ``regularity'' of the
dependence characterizes uniform hyperbolicity when the Lyapunov exponent is
positive. Our method is independent of arithmetic conditions on the frequency.