We describe a model of dark matter halo abundances and clustering which
combines the two most widely used approaches to this problem: that based on
peaks and the other based on excursion sets. Our approach can be thought of as
addressing the cloud-in-cloud problem for peaks and/or modifying the excursion
set approach so that it averages over a special subset, rather than all
possible walks. In this respect, it seeks to account for correlations between
steps in the walk as well as correlations between walks. We first show how the
excursion set and peaks models can be written in the same formalism, and then
use this correspondence to write our combined excursion set peaks model. We
then give simple expressions for the mass function and bias, showing that even
the linear halo bias factor is predicted to be k-dependent as a consequence of
the nonlocality associated with the peak constraint. At large masses, our model
has little or no need to rescale the variable delta_c from the value associated
with spherical collapse, and suggests a simple explanation for why the linear
halo bias factor appears to lie above that based on the peak-background split
at high masses when such a rescaling is assumed. Although we have concentrated
on peaks, our analysis is more generally applicable to other traditionally
single-scale analyses of large-scale structure.