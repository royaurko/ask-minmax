Password: Facility location problems form an important class of integer programming problems, with applications in the telecommunication, distribution and transportation industries. In this paper we are concerned with a particular type of facility location problem in which there exist two echelons of facilities. Each facility in the second echelon has limited capacity and can be supplied by only one facility in the first echelon. Each customer is serviced by only one facility in the second echelon. The number and location of facilities in both echelons together with the allocation of customers to the second-echelon facilities are to be determined simultaneously. We propose a Lagrangian relaxation-based branch and bound algorithm for its solution. We present numerical results for a large suite of test problems of realistic and practical size. These indicate that the method is efficient. It provides smaller branch and bound trees and requires less CPU time as compared to LP-based branch and bound obtained from a 0–1 integer package. Keywords Branch and bound ; Facilities ; Integer programming ; Optimization 1. Introduction Facility location problems are concerned with choosing the best location for facilities from a given set of potential sites so as to minimize the total cost while satisfying customer demand. This total cost is the sum of the fixed costs of opening facilities and the variable costs of assigning customers to the facilities. The literature in this area contains a wide range of variants and extensions, see for example Aikens [1] , Brandeau and Chiu [6] for an overview. In the uncapacitated facility location problem, each facility is assumed to have no limit on its capacity. In this case, each customer receives all its demand from exactly one facility. An extension of the uncapacitated facility location problem, in which two echelons of facilities are involved, is called the two-echelon uncapacitated facility location problem. In this problem, the deliveries are made from the first-echelon facilities (such as plants or depots) to customers via the second-echelon facilities (such as warehouses). The objective is to determine the number and location of facilities in each echelon, the flow of products between the facilities in different echelons and the assigning of the customers to facilities in the second echelon. In the capacitated facility location problem, each facility has a limit capacity. A special case of this problem, in which each customer receives supply from exactly one facility, is called the single-source capacitated facility location problem. It has been studied by several authors, including Barcelo and Casanovas [3] , Sridharan [28] , Klincewicz and Luss [16] , Pirkul [22] , Beasley [5] , Holmberg et al. [14] and Rönnqvist et al. [23] . In this paper, we consider a particular model of facility location problems, called the two-echelon, single-source, capacitated facility location problem (TSCFLP). This is an extension of the single-source, capacitated facility location problem in that there exist two echelons of facilities. Second-echelon facility has a limited capacity and can be supplied by only one second-echelon facility, and each customer is serviced by only one facility. Applications of this model arise in several areas. Telecommunication is one of the fastest growing industries in the world. Witin this area, location problems occur in many different circumstances. One important class of applications is when equipment of different kinds is to be installed, it could be concentrators, see Pirkul [22] , or other end equipment for optical fibers. The units to locate can be of very different sizes, from small electronic equipment to switching cabinets and exchange buildings. The units (i.e. facilities) to be installed are almost always capacitated, and the single sourcing property is also quite usual, i.e. the demand unit (i.e. customer) is connected to only one facility. A problem which involves decision about concentrators, cabinets and customers in a hierchical structure is studied by Williams [31] . This is a project done for a major telecommunication company and is equivalent to the two-echelon problem considered in this paper. Another area is distribution systems in which there are potentially multiple warehouses or depots from which vehicles in a fleet can operate. The model simultaneously determines how many depots and vehicles are needed, the location of the open depots, which vehicles should operate from which open depots and which customers each vehicle should service. A typical example is mail/box deliveries where there are several depots for the mail service company and where each depot has several delivery vans. Lagrangian relaxation, combined with subgradient optimization, is one of the most widely used approaches in determining the solution to hard and large combinatorial optimization problems. Details and applications of Lagrangian relaxation can be found in e.g. Fisher [9] and Geoffrion [13] . It has been a widely used technique in solving several variants of the facility location problem, including the uncapacitated facility location, see Galvão and Raggi [11] , the capacitated facility location problem, see Cornuejols et al. [8] , Christofides and Beasley [7] and Beasley [5] , and the single-source, capacitated facility location problem, see Klincewicz and Luss [16] , Pirkul [22] , Sridharan [28] Beasley [5] and Holmberg et al. [14] . Kaufman et al. [15] and Ro and Tcha [25] have proposed branch and bound (B&B) based algorithms to locate plants and warehouses in two-level distribution systems. Gao and Robinson [12] modified the uncapacitated facility location problem to the two-echelon uncapacitated facility location problem and implemented a dual-based B&B method. In these models, there are no capacity constraints and each facility and each customer can receive their supply/demand from multiple sources. Tragantalerngsak et al. [29] consider six different Lagrangian heuristics for solving the TSCFLP. All heuristics are implemented and the results show that the Lagrangian-based heuristics provide lower bounds that are much better than those obtained from a Linear Programming (LP) relaxation. Generation of feasible solutions to obtain upper bounds can also be done efficiently. This provides an indication that a B&B algorithm based on Lagrangian relaxation could constitute an efficient approach. This is what could be expected from such an approach, see Holmberg et al. [14] for such an example. In this paper, we present a B&B algorithm for the TSCFLP based on the most efficient Lagrangian heuristic found in [29] . The proposed algorithm consists of three stages based on the model characteristics inherent in the mathematical model. The outline of the paper is as follows. In Section 2 we formulate the mathematical model for TSCFLP. The Lagrangian relaxation used, generation of lower and upper bounds and subgradient optimization is briefly described in Section 3 . In Section 4 we discuss general B&B procedures for the problem, some reduction tests used and the three-staged B&B procedure that is used. We describe our test problems and discuss the numerical results in Section 5 . A discussion about aspects of the implementation is carried out in Section 6 and finally in Section 7 we make some conclusions. 2. Mathematical model To formulate the TSCFLP problem, we introduce the following notation. Let We can then state the problem as The objective function (1) is the total cost consisting of the cost of assigning customers to facilities, the cost of establishing facilities and the cost of opening depots. Constraint set (2) ensures that the customer demand serviced by a certain facility cannot exceed its capacity. Constraint set (3) ensures that each customer is assigned to exactly one facility. Constraint set (4) ensures that each facility can be serviced by only one depot, and (5) ensures that the assignments are made only to open facilities. The corresponding requirement of assigning facilities to open depots is taken care of by (6). Finally, all variables used in the models are required to be binary. The standard capacitated facility location problem is NP-hard, see e.g. Mirchandani and Francis [19] . As this is a special case of our problem it follows that [P] also is NP-hard. 3. Lagrangian heuristics A Lagrangian relaxation is created by removing (relaxing) a set of constraints, weighting them with Lagrangian multipliers and then placing them in the objective function. The purpose is to obtain a relaxed problem, called Lagrangian subproblem, which is easier to solve than the original problem. The objective value from the Lagrangian relaxation problem, for any given set of multipliers, provides a lower bound (in the case of minimization) for the optimal solution to the original problem. The best lower bound can be derived by solving the Lagrangian dual. Since the dual function most often is non-differentiable there is a need to use a special method for this class of problems. A frequently used and efficient method is subgradient optimization. Information obtained from the Lagrangian relaxation is then often used by application-dependent heuristics to construct feasible solutions and hence upper bounds to the original problem.