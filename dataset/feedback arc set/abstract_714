Cosmological hydrodynamical simulations of galaxy formation in representative
regions of the Universe typically need to resort to subresolution models to
follow some of the feedback processes crucial for galaxy formation. Here, we
show that an energy-driven outflow model in which the wind velocity decreases
and the wind mass loading increases in low-mass galaxies, as suggested by
observations, can produce a good match to the low-mass end of the observed
galaxy stellar mass function. The high-mass end can be recovered simultaneously
if feedback from active galactic nuclei (AGN) and a correction for diffuse
stellar light plausibly missed in observations are included. At the same time,
our model is in good agreement with the stellar mass functions at redshifts z=1
and z=2, and with the observed redshift evolution of the cosmic star formation
rate density. In addition, it accurately reproduces the observed gas to stellar
mass ratios and specific star formation rates of galaxies as a function of
their stellar mass. This agreement with a diverse set of data marks significant
progress in hydrodynamically modelling the formation of a representative galaxy
population. It also suggests that the mass flux in real galactic winds should
strongly increase towards low-mass galaxies. Without this assumption, an
overproduction of galaxies at the faint-end of the galaxy luminosity function
seems inevitable in our models.