We present a first-principles method for deriving effective low-energy models
of electrons in solids having entangled band structure. The procedure starts
with dividing the Hilbert space into two subspaces, the low-energy part ("$d$
space'') and the rest of the space ("$r$ space''). The low-energy model is
constructed for the $d$ space by eliminating the degrees of freedom of the $r$
space. The thus derived model contains the strength of electron correlation
expressed by a partially screened Coulomb interaction, calculated in the
constrained random-phase-approximation (cRPA) where screening channels within
the $d$ space, $P_d$, are subtracted. One conceptual problem of this
established downfolding method is that for entangled bands it is not clear how
to cut out the $d$ space and how to distinguish $P_d$ from the total
polarization. Here, we propose a simple procedure to overcome this difficulty.
In our scheme, the $d$ subspace is cut out from the Hilbert space of the Kohn
Sham eigenfunctions with the help of a procedure to construct a localized
Wannier basis. The $r$ subspace is constructed as the complementary space
orthogonal to the $d$ subspace. After this disentanglement, $P_d$ becomes well
defined. Using the disentangled bands, the effective parameters are uniquely
determined in the cRPA. The method is successfully applied to 3$d$ transition
metals.