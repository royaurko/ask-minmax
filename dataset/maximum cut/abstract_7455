A selfconsistent theory of the current-induced switching of magnetization
using nonequilibrium Keldysh formalism is developed for a junction of two
ferromagnets separated by a nonmagnetic spacer. It is shown that the
spin-transfer torques responsible for current-induced switching of
magnetization can be calculated from first principles in a steady state when
the magnetization of the switching magnet is stationary. The spin-transfer
torque is expressed in terms of one-electron surface Green functions for the
junction cut into two independent parts by a cleavage plane immediately to the
left and right of the switching magnet. The surface Green functions are
calculated using a tight-binding Hamiltonian with parameters determined from a
fit to an {\it ab initio} band structure.This treatment yields the spin
transfer torques taking into account rigorously contributions from all the
parts of the junction. To calculate the hysteresis loops of resistance versus
current, and hence to determine the critical current for switching, the
microscopically calculated spin-transfer torques are used as an input into the
phenomenological Landau-Lifshitz equation with Gilbert damping. The present
calculations for Co/Cu/Co(111) show that the critical current for switching is
$\approx 10^7A/cm^2$, which is in good agreement with experiment.