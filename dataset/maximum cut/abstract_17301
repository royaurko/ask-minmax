We report the evolution of magnetic field and its energy in NOAA active
region 11158 over 5 days based on a vector magnetogram series from the
Helioseismic and Magnetic Imager (HMI) on board the Solar Dynamic Observatory
(SDO). Fast flux emergence and strong shearing motion led to a quadrupolar
sunspot complex that produced several major eruptions, including the first
X-class flare of Solar Cycle 24. Extrapolated non-linear force-free coronal
fields show substantial electric current and free energy increase during early
flux emergence near a low-lying sigmoidal filament with sheared kilogauss field
in the filament channel. The computed magnetic free energy reaches a maximum of
~2.6e32 erg, about 50% of which is stored below 6 Mm. It decreases by ~0.3e32
erg within 1 hour of the X-class flare, which is likely an underestimation of
the actual energy loss. During the flare, the photospheric field changed
rapidly: horizontal field was enhanced by 28% in the core region, becoming more
inclined and more parallel to the polarity inversion line. Such change is
consistent with the conjectured coronal field "implosion", and is supported by
the coronal loop retraction observed by the Atmospheric Imaging Assembly (AIA).
The extrapolated field becomes more "compact" after the flare, with shorter
loops in the core region, probably because of reconnection. The coronal field
becomes slightly more sheared in the lowest layer, relaxes faster with height,
and is overall less energetic.