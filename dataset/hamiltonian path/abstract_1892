Starting from a Lie algebroid ${\cal A}$ over a space V we lift its action
to the canonical transformations on the principle affine bundle ${\cal R}$ over
the cotangent bundle $T^*V$. Such lifts are classified by the first cohomology
$H^1({\cal A})$. The resulting object is the Hamiltonian algebroid ${\cal A}^H$
over ${\cal R}$ with the anchor map from $\G({\cal A}^H)$ to Hamiltonians of
canonical transformations. Hamiltonian algebroids generalize the Lie algebras
of canonical transformations. We prove that the BRST operator for ${\cal A}^H$
is cubic in the ghost fields as in the Lie algebra case. To illustrate this
construction we analyze two topological field theories. First, we define a Lie
algebroid over the space $V_3$ of $\SL$-opers on a Riemann curve $\Si_{g,n}$ of
genus g with n marked points. The sections of this algebroid are the second
order differential operators on $\Si_{g,n}$. The algebroid is lifted to the
Hamiltonian algebroid over the phase space of $W_3$-gravity. We describe the
BRST operator leading to the moduli space of $W_3$-gravity. In accordance with
the general construction the BRST operator is cubic in the ghost fields. We
present the Chern-Simons explanation of our results. The second example is the
Hamiltonian algebroid structure in the Poisson sigma-model invoked by Cattaneo
and Felder to describe the Kontsevich deformation quantization formula. The
hamiltonian description of the Poisson sigma-model leads to the Lie algebraic
form of the BRST operator.