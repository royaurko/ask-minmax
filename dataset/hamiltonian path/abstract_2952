We introduce a deformation of the method of characteristics valid for
Hamiltonian perturbations of a scalar conservation law in the small dispersion
limit. Our method of analysis is based on the 'variational string equation', a
functional-differential relation originally introduced by Dubrovin in a
particular case, of which we lay the mathematical foundation.
  Starting from first principles, we construct the string equation explicitly
up to the fourth order in perturbation theory, and we show that the solution to
the Cauchy problem of the Hamiltonian PDE satisfies the appropriate string
equation in the small dispersion limit. We apply our construction to explicitly
compute the first two perturbative corrections of the solution to the general
Hamiltonian PDE. In the KdV case, we prove the existence of a quasi-triviality
transformation at any order and for arbitrary initial data.