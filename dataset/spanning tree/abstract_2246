Generalizing the classical matrix-tree theorem we provide a formula counting
subgraphs of a given graph with a fixed 2-core. We use this generalization to
obtain an analog of the matrix-tree theorem for the root system $D_n$ (the
classical theorem corresponds to the $A_n$-case). Several byproducts of the
developed technique, such as a new formula for a specialization of the
multivariate Tutte polynomial, are of independent interest.