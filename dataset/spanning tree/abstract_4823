We study the scaling limits of three different aggregation models on the
integer lattice Z^d: internal DLA, in which particles perform random walks
until reaching an unoccupied site; the rotor-router model, in which particles
perform deterministic analogues of random walks; and the divisible sandpile, in
which each site distributes its excess mass equally among its neighbors. As the
lattice spacing tends to zero, all three models are found to have the same
scaling limit, which we describe as the solution to a certain PDE free boundary
problem in R^d. In particular, internal DLA has a deterministic scaling limit.
We find that the scaling limits are quadrature domains, which have arisen
independently in many fields such as potential theory and fluid dynamics. Our
results apply both to the case of multiple point sources and to the
Diaconis-Fulton smash sum of domains. In the special case when all particles
start at a single site, we show that the scaling limit is a Euclidean ball in
R^d, and give quantitative bounds on the rate of convergence to a ball. We also
improve on the previously best known bounds of Le Borgne and Rossin in Z^2 and
Fey and Redig in higher dimensions for the shape of the classical abelian
sandpile model. Lastly, we study the sandpile group of a regular tree whose
leaves are collapsed to a single sink vertex, and determine the decomposition
of the full sandpile group as a product of cyclic groups. For the regular
ternary tree of height n, for example, the sandpile group is isomorphic to
(Z_3)^{2^{n-3}} x (Z_7)^{2^{n-4}} x ... x Z_{2^{n-1}-1} x Z_{2^n-1}. We use
this result to prove that rotor-router aggregation on the regular tree yields a
perfect ball.