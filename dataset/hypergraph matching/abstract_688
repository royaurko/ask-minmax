Recent multiway join algorithms have been shown to be asymptotically faster
than any sequence of pairwise joins. Generalized Hypertree Decompositions
(GHDs), introduced by Gottlob et al., provide a query plan for utilizing these
multiway join algorithms to solve conjunctive queries. It is interesting to
extend these new algorithms and query plans to more sophisticated queries, e.g.
those including aggregations. Inspired by the semi-ring annotations of Green et
al. and the query language of Abo Khamis et al., we study a class of queries
involving aggregations and joins over annotated relations. Our queries are rich
enough to capture traditional notions of queries with aggregations, e.g. group
by aggregations in SQL, as well as a wide range of problems outside traditional
data processing, e.g. message passing in graphical models. We then extend
existing algorithms and structures to answer these queries. Our work has three
primary contributions. First, we recover and improve the state of the art by
placing a simple, easy to check condition on permissible GHDs. Second, we
describe how to construct these "valid" GHDs by stitching together (ordinary)
GHDs of a series of hypergraphs. This allows us to apply a series of existing
research on GHDs, including some that provides strongest-known runtime
guarantees for both serial and distributed join algorithm. Finally, we extend
our problem to compute queries with multiple different aggregations, delving
into and characterizing completely the details of how aggregations and joins
can be reordered.