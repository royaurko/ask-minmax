In this paper we study the component structure of random graphs with
independence between the edges. Under mild assumptions, we determine whether
there is a giant component, and find its asymptotic size when it exists. We
assume that the sequence of matrices of edge probabilities converges to an
appropriate limit object (a kernel), but only in a very weak sense, namely in
the cut metric. Our results thus generalize previous results on the phase
transition in the already very general inhomogeneous random graph model we
introduced recently, as well as related results of Bollob\'as, Borgs, Chayes
and Riordan, all of which involve considerably stronger assumptions. We also
prove corresponding results for random hypergraphs; these generalize our
results on the phase transition in inhomogeneous random graphs with clustering.